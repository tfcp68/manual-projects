Девочка Маша гуляла в лесу и нашла полное бинарное дерево высоты n и перестановку p длины m = 2^n.  

Перестановка — это последовательность длины n целых чисел от 1 до n, в которой все числа встречаются ровно по одному разу. Например, [1, 3, 5, 2, 4], [3,4,2,1], [1,3,2] — перестановки, а [2,3,2], [4,3,1], [0] — нет.

Пронумеруем m листьев этого дерева слева направо. В листе с номером i записано значение pi (1 ≤ i ≤ m).  Например, если n=2, p=[3,1,4,2], дерево будет выглядеть так:

<div style="display:flex; align-items: center;"> 
	<div style="flex:1; mix-blend-mode:difference; filter:invert(1);"> 
		<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 562.1377611092589 384.2310650210519" width="562.1377611092589" height="384.2310650210519">
  <!-- svg-source:excalidraw -->
  
  <defs>
    <style class="style-fonts">
      @font-face {
        font-family: "Virgil";
        src: url("https://excalidraw.com/Virgil.woff2");
      }
      @font-face {
        font-family: "Cascadia";
        src: url("https://excalidraw.com/Cascadia.woff2");
      }
    </style>
  </defs>
  <rect x="0" y="0" width="562.1377611092589" height="384.2310650210519" fill="none"></rect><g stroke-linecap="round" transform="translate(250.7091659325115 10) rotate(0 29.636864273972833 30.35971462211853)"><path d="M59.27 30.36 C59.27 32.12, 59.12 33.9, 58.82 35.63 C58.53 37.36, 58.07 39.09, 57.49 40.74 C56.9 42.39, 56.16 44.02, 55.3 45.54 C54.45 47.06, 53.44 48.53, 52.34 49.87 C51.24 51.22, 50 52.49, 48.69 53.62 C47.37 54.75, 45.94 55.77, 44.46 56.65 C42.97 57.53, 41.39 58.29, 39.77 58.89 C38.16 59.49, 36.47 59.95, 34.78 60.26 C33.09 60.56, 31.35 60.72, 29.64 60.72 C27.92 60.72, 26.18 60.56, 24.49 60.26 C22.8 59.95, 21.11 59.49, 19.5 58.89 C17.89 58.29, 16.3 57.53, 14.82 56.65 C13.33 55.77, 11.9 54.75, 10.59 53.62 C9.27 52.49, 8.04 51.22, 6.93 49.87 C5.83 48.53, 4.83 47.06, 3.97 45.54 C3.11 44.02, 2.37 42.39, 1.79 40.74 C1.2 39.09, 0.75 37.36, 0.45 35.63 C0.15 33.9, 0 32.12, 0 30.36 C0 28.6, 0.15 26.82, 0.45 25.09 C0.75 23.36, 1.2 21.63, 1.79 19.98 C2.37 18.32, 3.11 16.7, 3.97 15.18 C4.83 13.66, 5.83 12.19, 6.93 10.84 C8.04 9.5, 9.27 8.23, 10.59 7.1 C11.9 5.97, 13.33 4.95, 14.82 4.07 C16.3 3.19, 17.89 2.43, 19.5 1.83 C21.11 1.23, 22.8 0.77, 24.49 0.46 C26.18 0.16, 27.92 0, 29.64 0 C31.35 0, 33.09 0.16, 34.78 0.46 C36.47 0.77, 38.16 1.23, 39.77 1.83 C41.39 2.43, 42.97 3.19, 44.46 4.07 C45.94 4.95, 47.37 5.97, 48.69 7.1 C50 8.23, 51.24 9.5, 52.34 10.84 C53.44 12.19, 54.45 13.66, 55.3 15.18 C56.16 16.7, 56.9 18.32, 57.49 19.98 C58.07 21.63, 58.53 23.36, 58.82 25.09 C59.12 26.82, 59.2 29.48, 59.27 30.36 C59.35 31.24, 59.35 29.48, 59.27 30.36" stroke="#000000" stroke-width="4" fill="none"></path></g><g stroke-linecap="round" transform="translate(411.9047935689973 118.42755222185224) rotate(0 29.636864273972833 30.35971462211853)"><path d="M59.27 30.36 C59.27 32.12, 59.12 33.9, 58.82 35.63 C58.53 37.36, 58.07 39.09, 57.49 40.74 C56.9 42.39, 56.16 44.02, 55.3 45.54 C54.45 47.06, 53.44 48.53, 52.34 49.87 C51.24 51.22, 50 52.49, 48.69 53.62 C47.37 54.75, 45.94 55.77, 44.46 56.65 C42.97 57.53, 41.39 58.29, 39.77 58.89 C38.16 59.49, 36.47 59.95, 34.78 60.26 C33.09 60.56, 31.35 60.72, 29.64 60.72 C27.92 60.72, 26.18 60.56, 24.49 60.26 C22.8 59.95, 21.11 59.49, 19.5 58.89 C17.89 58.29, 16.3 57.53, 14.82 56.65 C13.33 55.77, 11.9 54.75, 10.59 53.62 C9.27 52.49, 8.04 51.22, 6.93 49.87 C5.83 48.53, 4.83 47.06, 3.97 45.54 C3.11 44.02, 2.37 42.39, 1.79 40.74 C1.2 39.09, 0.75 37.36, 0.45 35.63 C0.15 33.9, 0 32.12, 0 30.36 C0 28.6, 0.15 26.82, 0.45 25.09 C0.75 23.36, 1.2 21.63, 1.79 19.98 C2.37 18.32, 3.11 16.7, 3.97 15.18 C4.83 13.66, 5.83 12.19, 6.93 10.84 C8.04 9.5, 9.27 8.23, 10.59 7.1 C11.9 5.97, 13.33 4.95, 14.82 4.07 C16.3 3.19, 17.89 2.43, 19.5 1.83 C21.11 1.23, 22.8 0.77, 24.49 0.46 C26.18 0.16, 27.92 0, 29.64 0 C31.35 0, 33.09 0.16, 34.78 0.46 C36.47 0.77, 38.16 1.23, 39.77 1.83 C41.39 2.43, 42.97 3.19, 44.46 4.07 C45.94 4.95, 47.37 5.97, 48.69 7.1 C50 8.23, 51.24 9.5, 52.34 10.84 C53.44 12.19, 54.45 13.66, 55.3 15.18 C56.16 16.7, 56.9 18.32, 57.49 19.98 C58.07 21.63, 58.53 23.36, 58.82 25.09 C59.12 26.82, 59.2 29.48, 59.27 30.36 C59.35 31.24, 59.35 29.48, 59.27 30.36" stroke="#000000" stroke-width="4" fill="none"></path></g><g stroke-linecap="round" transform="translate(90.95923899231593 122.76465431072666) rotate(0 29.636864273972833 30.35971462211853)"><path d="M59.27 30.36 C59.27 32.12, 59.12 33.9, 58.82 35.63 C58.53 37.36, 58.07 39.09, 57.49 40.74 C56.9 42.39, 56.16 44.02, 55.3 45.54 C54.45 47.06, 53.44 48.53, 52.34 49.87 C51.24 51.22, 50 52.49, 48.69 53.62 C47.37 54.75, 45.94 55.77, 44.46 56.65 C42.97 57.53, 41.39 58.29, 39.77 58.89 C38.16 59.49, 36.47 59.95, 34.78 60.26 C33.09 60.56, 31.35 60.72, 29.64 60.72 C27.92 60.72, 26.18 60.56, 24.49 60.26 C22.8 59.95, 21.11 59.49, 19.5 58.89 C17.89 58.29, 16.3 57.53, 14.82 56.65 C13.33 55.77, 11.9 54.75, 10.59 53.62 C9.27 52.49, 8.04 51.22, 6.93 49.87 C5.83 48.53, 4.83 47.06, 3.97 45.54 C3.11 44.02, 2.37 42.39, 1.79 40.74 C1.2 39.09, 0.75 37.36, 0.45 35.63 C0.15 33.9, 0 32.12, 0 30.36 C0 28.6, 0.15 26.82, 0.45 25.09 C0.75 23.36, 1.2 21.63, 1.79 19.98 C2.37 18.32, 3.11 16.7, 3.97 15.18 C4.83 13.66, 5.83 12.19, 6.93 10.84 C8.04 9.5, 9.27 8.23, 10.59 7.1 C11.9 5.97, 13.33 4.95, 14.82 4.07 C16.3 3.19, 17.89 2.43, 19.5 1.83 C21.11 1.23, 22.8 0.77, 24.49 0.46 C26.18 0.16, 27.92 0, 29.64 0 C31.35 0, 33.09 0.16, 34.78 0.46 C36.47 0.77, 38.16 1.23, 39.77 1.83 C41.39 2.43, 42.97 3.19, 44.46 4.07 C45.94 4.95, 47.37 5.97, 48.69 7.1 C50 8.23, 51.24 9.5, 52.34 10.84 C53.44 12.19, 54.45 13.66, 55.3 15.18 C56.16 16.7, 56.9 18.32, 57.49 19.98 C58.07 21.63, 58.53 23.36, 58.82 25.09 C59.12 26.82, 59.2 29.48, 59.27 30.36 C59.35 31.24, 59.35 29.48, 59.27 30.36" stroke="#000000" stroke-width="4" fill="none"></path></g><g stroke-linecap="round" transform="translate(492.86403256131325 278.90032951019305) rotate(0 29.636864273972833 30.35971462211853)"><path d="M59.27 30.36 C59.27 32.12, 59.12 33.9, 58.82 35.63 C58.53 37.36, 58.07 39.09, 57.49 40.74 C56.9 42.39, 56.16 44.02, 55.3 45.54 C54.45 47.06, 53.44 48.53, 52.34 49.87 C51.24 51.22, 50 52.49, 48.69 53.62 C47.37 54.75, 45.94 55.77, 44.46 56.65 C42.97 57.53, 41.39 58.29, 39.77 58.89 C38.16 59.49, 36.47 59.95, 34.78 60.26 C33.09 60.56, 31.35 60.72, 29.64 60.72 C27.92 60.72, 26.18 60.56, 24.49 60.26 C22.8 59.95, 21.11 59.49, 19.5 58.89 C17.89 58.29, 16.3 57.53, 14.82 56.65 C13.33 55.77, 11.9 54.75, 10.59 53.62 C9.27 52.49, 8.04 51.22, 6.93 49.87 C5.83 48.53, 4.83 47.06, 3.97 45.54 C3.11 44.02, 2.37 42.39, 1.79 40.74 C1.2 39.09, 0.75 37.36, 0.45 35.63 C0.15 33.9, 0 32.12, 0 30.36 C0 28.6, 0.15 26.82, 0.45 25.09 C0.75 23.36, 1.2 21.63, 1.79 19.98 C2.37 18.32, 3.11 16.7, 3.97 15.18 C4.83 13.66, 5.83 12.19, 6.93 10.84 C8.04 9.5, 9.27 8.23, 10.59 7.1 C11.9 5.97, 13.33 4.95, 14.82 4.07 C16.3 3.19, 17.89 2.43, 19.5 1.83 C21.11 1.23, 22.8 0.77, 24.49 0.46 C26.18 0.16, 27.92 0, 29.64 0 C31.35 0, 33.09 0.16, 34.78 0.46 C36.47 0.77, 38.16 1.23, 39.77 1.83 C41.39 2.43, 42.97 3.19, 44.46 4.07 C45.94 4.95, 47.37 5.97, 48.69 7.1 C50 8.23, 51.24 9.5, 52.34 10.84 C53.44 12.19, 54.45 13.66, 55.3 15.18 C56.16 16.7, 56.9 18.32, 57.49 19.98 C58.07 21.63, 58.53 23.36, 58.82 25.09 C59.12 26.82, 59.2 29.48, 59.27 30.36 C59.35 31.24, 59.35 29.48, 59.27 30.36" stroke="#000000" stroke-width="4" fill="none"></path></g><g stroke-linecap="round" transform="translate(338.1740580581386 278.90032951019305) rotate(0 29.636864273972833 30.35971462211853)"><path d="M59.27 30.36 C59.27 32.12, 59.12 33.9, 58.82 35.63 C58.53 37.36, 58.07 39.09, 57.49 40.74 C56.9 42.39, 56.16 44.02, 55.3 45.54 C54.45 47.06, 53.44 48.53, 52.34 49.87 C51.24 51.22, 50 52.49, 48.69 53.62 C47.37 54.75, 45.94 55.77, 44.46 56.65 C42.97 57.53, 41.39 58.29, 39.77 58.89 C38.16 59.49, 36.47 59.95, 34.78 60.26 C33.09 60.56, 31.35 60.72, 29.64 60.72 C27.92 60.72, 26.18 60.56, 24.49 60.26 C22.8 59.95, 21.11 59.49, 19.5 58.89 C17.89 58.29, 16.3 57.53, 14.82 56.65 C13.33 55.77, 11.9 54.75, 10.59 53.62 C9.27 52.49, 8.04 51.22, 6.93 49.87 C5.83 48.53, 4.83 47.06, 3.97 45.54 C3.11 44.02, 2.37 42.39, 1.79 40.74 C1.2 39.09, 0.75 37.36, 0.45 35.63 C0.15 33.9, 0 32.12, 0 30.36 C0 28.6, 0.15 26.82, 0.45 25.09 C0.75 23.36, 1.2 21.63, 1.79 19.98 C2.37 18.32, 3.11 16.7, 3.97 15.18 C4.83 13.66, 5.83 12.19, 6.93 10.84 C8.04 9.5, 9.27 8.23, 10.59 7.1 C11.9 5.97, 13.33 4.95, 14.82 4.07 C16.3 3.19, 17.89 2.43, 19.5 1.83 C21.11 1.23, 22.8 0.77, 24.49 0.46 C26.18 0.16, 27.92 0, 29.64 0 C31.35 0, 33.09 0.16, 34.78 0.46 C36.47 0.77, 38.16 1.23, 39.77 1.83 C41.39 2.43, 42.97 3.19, 44.46 4.07 C45.94 4.95, 47.37 5.97, 48.69 7.1 C50 8.23, 51.24 9.5, 52.34 10.84 C53.44 12.19, 54.45 13.66, 55.3 15.18 C56.16 16.7, 56.9 18.32, 57.49 19.98 C58.07 21.63, 58.53 23.36, 58.82 25.09 C59.12 26.82, 59.2 29.48, 59.27 30.36 C59.35 31.24, 59.35 29.48, 59.27 30.36" stroke="#000000" stroke-width="4" fill="none"></path></g><g stroke-linecap="round" transform="translate(156.01577032542764 278.90032951019305) rotate(0 29.636864273972833 30.35971462211853)"><path d="M59.27 30.36 C59.27 32.12, 59.12 33.9, 58.82 35.63 C58.53 37.36, 58.07 39.09, 57.49 40.74 C56.9 42.39, 56.16 44.02, 55.3 45.54 C54.45 47.06, 53.44 48.53, 52.34 49.87 C51.24 51.22, 50 52.49, 48.69 53.62 C47.37 54.75, 45.94 55.77, 44.46 56.65 C42.97 57.53, 41.39 58.29, 39.77 58.89 C38.16 59.49, 36.47 59.95, 34.78 60.26 C33.09 60.56, 31.35 60.72, 29.64 60.72 C27.92 60.72, 26.18 60.56, 24.49 60.26 C22.8 59.95, 21.11 59.49, 19.5 58.89 C17.89 58.29, 16.3 57.53, 14.82 56.65 C13.33 55.77, 11.9 54.75, 10.59 53.62 C9.27 52.49, 8.04 51.22, 6.93 49.87 C5.83 48.53, 4.83 47.06, 3.97 45.54 C3.11 44.02, 2.37 42.39, 1.79 40.74 C1.2 39.09, 0.75 37.36, 0.45 35.63 C0.15 33.9, 0 32.12, 0 30.36 C0 28.6, 0.15 26.82, 0.45 25.09 C0.75 23.36, 1.2 21.63, 1.79 19.98 C2.37 18.32, 3.11 16.7, 3.97 15.18 C4.83 13.66, 5.83 12.19, 6.93 10.84 C8.04 9.5, 9.27 8.23, 10.59 7.1 C11.9 5.97, 13.33 4.95, 14.82 4.07 C16.3 3.19, 17.89 2.43, 19.5 1.83 C21.11 1.23, 22.8 0.77, 24.49 0.46 C26.18 0.16, 27.92 0, 29.64 0 C31.35 0, 33.09 0.16, 34.78 0.46 C36.47 0.77, 38.16 1.23, 39.77 1.83 C41.39 2.43, 42.97 3.19, 44.46 4.07 C45.94 4.95, 47.37 5.97, 48.69 7.1 C50 8.23, 51.24 9.5, 52.34 10.84 C53.44 12.19, 54.45 13.66, 55.3 15.18 C56.16 16.7, 56.9 18.32, 57.49 19.98 C58.07 21.63, 58.53 23.36, 58.82 25.09 C59.12 26.82, 59.2 29.48, 59.27 30.36 C59.35 31.24, 59.35 29.48, 59.27 30.36" stroke="#000000" stroke-width="4" fill="none"></path></g><g stroke-linecap="round" transform="translate(10 278.90032951019305) rotate(0 29.636864273972833 30.35971462211853)"><path d="M59.27 30.36 C59.27 32.12, 59.12 33.9, 58.82 35.63 C58.53 37.36, 58.07 39.09, 57.49 40.74 C56.9 42.39, 56.16 44.02, 55.3 45.54 C54.45 47.06, 53.44 48.53, 52.34 49.87 C51.24 51.22, 50 52.49, 48.69 53.62 C47.37 54.75, 45.94 55.77, 44.46 56.65 C42.97 57.53, 41.39 58.29, 39.77 58.89 C38.16 59.49, 36.47 59.95, 34.78 60.26 C33.09 60.56, 31.35 60.72, 29.64 60.72 C27.92 60.72, 26.18 60.56, 24.49 60.26 C22.8 59.95, 21.11 59.49, 19.5 58.89 C17.89 58.29, 16.3 57.53, 14.82 56.65 C13.33 55.77, 11.9 54.75, 10.59 53.62 C9.27 52.49, 8.04 51.22, 6.93 49.87 C5.83 48.53, 4.83 47.06, 3.97 45.54 C3.11 44.02, 2.37 42.39, 1.79 40.74 C1.2 39.09, 0.75 37.36, 0.45 35.63 C0.15 33.9, 0 32.12, 0 30.36 C0 28.6, 0.15 26.82, 0.45 25.09 C0.75 23.36, 1.2 21.63, 1.79 19.98 C2.37 18.32, 3.11 16.7, 3.97 15.18 C4.83 13.66, 5.83 12.19, 6.93 10.84 C8.04 9.5, 9.27 8.23, 10.59 7.1 C11.9 5.97, 13.33 4.95, 14.82 4.07 C16.3 3.19, 17.89 2.43, 19.5 1.83 C21.11 1.23, 22.8 0.77, 24.49 0.46 C26.18 0.16, 27.92 0, 29.64 0 C31.35 0, 33.09 0.16, 34.78 0.46 C36.47 0.77, 38.16 1.23, 39.77 1.83 C41.39 2.43, 42.97 3.19, 44.46 4.07 C45.94 4.95, 47.37 5.97, 48.69 7.1 C50 8.23, 51.24 9.5, 52.34 10.84 C53.44 12.19, 54.45 13.66, 55.3 15.18 C56.16 16.7, 56.9 18.32, 57.49 19.98 C58.07 21.63, 58.53 23.36, 58.82 25.09 C59.12 26.82, 59.2 29.48, 59.27 30.36 C59.35 31.24, 59.35 29.48, 59.27 30.36" stroke="#000000" stroke-width="4" fill="none"></path></g><g transform="translate(30.717777207838935 330.8280497461649) rotate(0 10.546875 21.600000000000023)"><text x="0" y="0" font-family="Cascadia, Segoe UI Emoji" font-size="36px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">3</text></g><g transform="translate(176.75447557057896 330.5339908524903) rotate(0 10.546875 21.600000000000023)"><text x="0" y="0" font-family="Cascadia, Segoe UI Emoji" font-size="36px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">1</text></g><g transform="translate(356.67592954476254 329.08829015619904) rotate(0 10.546875 21.600000000000023)"><text x="0" y="0" font-family="Cascadia, Segoe UI Emoji" font-size="36px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">4</text></g><g transform="translate(511.9540218352861 331.03106502105186) rotate(0 10.546875 21.600000000000023)"><text x="0" y="0" font-family="Cascadia, Segoe UI Emoji" font-size="36px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">2</text></g><g stroke-linecap="round"><g transform="translate(253.60056732509383 54.81672158503238) rotate(0 -56.24323652715293 38.311068451720985)"><path d="M0 0 C-18.75 12.77, -93.74 63.85, -112.49 76.62 M0 0 C-18.75 12.77, -93.74 63.85, -112.49 76.62" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(309.9828944804567 43.251116014701665) rotate(0 54.936626459071704 41.202469844303664)"><path d="M0 0 C18.31 13.73, 91.56 68.67, 109.87 82.4 M0 0 C18.31 13.73, 91.56 68.67, 109.87 82.4" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(425.63895018376525 174.8098793772151) rotate(0 -22.408360792515964 53.49092576278025)"><path d="M0 0 C-7.47 17.83, -37.35 89.15, -44.82 106.98 M0 0 C-7.47 17.83, -37.35 89.15, -44.82 106.98" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(464.39468772721193 170.43624767888014) rotate(0 26.16170316145451 54.23204091565634)"><path d="M0 0 C8.72 18.08, 43.6 90.39, 52.32 108.46 M0 0 C8.72 18.08, 43.6 90.39, 52.32 108.46" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(48.31106845172121 280.3460302064841) rotate(0 28.191163577681436 -50.59952437019746)"><path d="M0 0 C9.4 -16.87, 46.99 -84.33, 56.38 -101.2 M0 0 C9.4 -16.87, 46.99 -84.33, 56.38 -101.2" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(140.45841639627906 176.639744775282) rotate(0 19.537328797395617 50.85451760498563)"><path d="M0 0 C6.51 16.95, 32.56 84.76, 39.07 101.71 M0 0 C6.51 16.95, 32.56 84.76, 39.07 101.71" stroke="#000000" stroke-width="4" fill="none"></path></g></g><mask></mask></svg>
	</div> 
</div>

Маша считает дерево красивым, если значения в его листьях упорядочены слева направо по возрастанию.

За одну операцию Маша может выбрать произвольную не являющуюся листом вершину дерева и поменять местами ее левого и правого сына (вместе с их поддеревьями).

Помогите Маше понять, сможет ли она за некоторое количество операций сделать дерево красивым. Если сможет, то выведите минимальное количество операций, чтобы сделать дерево красивым.

---
Применим нашу стратегию для решения этой задачи.

Наше дерево мы можем представить просто в виде массива p. Тогда операция  смены сыновей - перемещение элементов в массиве. 

Разделим наш массив на группы по 2 элемента. (Это всегда получится сделать, т. к. количество элементов перестановки - это степень двойки) Получим все поддеревья с двумя сыновьями. Теперь проверяем элементы в группах: если они не идут в порядке возрастания, то сортируем их и увеличиваем счётчик операций на 1.

Теперь мы будем сравнивать группы элементов (увеличиваем размер поддеревьев). Если первый элемент первой группы больше первого элемента второй группы (сравниваем по первому элементу, т. к. он будет минимальным для каждой группы), то увеличиваем счётчик операций на 1, меняем группы местами и объединяем их в одну, при этом порядок элементов в группе сохраняется.  
Например, [ [7, 8], [1, 2], [5, 6], [3, 4] ] - наш массив с группами, тогда при сравнении групп получим - [ [1, 2, 7, 8], [3, 4, 5, 6] ]. 

После объединения группы стали на 4 элемента. Рекурсивно повторяем, пока количество элементов в группе не станет равно длине изначального массива.

После всех этих преобразований массив будет либо отсортированным, тогда мы выводим количество операций, либо неотсортированным, тогда выводим -1.

#### Псевдокод
```
p <- изначальный массив

// делим массив на группы
new_p <- split_p(p) 


// функция сравнения групп
функция sort_p(new_p)

	cnt <- 0
	если длина new_p <= 1
		то вернуть new_p, cnt 
	
	для group в new_p
		если первый элемент group[1] > первый элемент group[2]
			то сортируем и объединяем group[1] и group[2]
			   cnt += 1
		иначе
		    объединеям group[1] и group[2]
		    
	вернуть sort_p(new_p, cnt)

```

#### Реализация на языке Python
```python
def split_p(p):  
    if len(p) <= 2:  
        return [p]  
        
    first, second = p[:len(p)//2], p[len(p)//2:]  
    return split_p(first) + split_p(second)  
  

def sort_p(p, cnt):  
    if len(p) <= 1:  
        return p[0], cnt  
        
    new_p = []  
    for i in range(0, len(p) - 1, 2):  
        if p[i][0] > p[i + 1][0]:  
            new_p.append(p[i + 1] + p[i])  
            cnt += 1  
            
        else:  
            new_p.append(p[i] + p[i + 1])  
            
    return sort_p(new_p, cnt)  
  
  
def solve():  
    m = int(input())  
    p = list(map(int, input().split())) 
     
    if p == list(sorted(p)):  
        print(0)  
        return  
  
    p = split_p(p)    
    cnt = 0  
    
    for i in range(0, len(p)):  
        if p[i][0] > p[i][1]:  
            p[i] = [p[i][1], p[i][0]]  
            cnt += 1  
  
    new_p, cnt = sort_p(p, cnt)  
    if new_p == list(sorted(new_p)):  
        print(cnt)  
        
    else:  
        print(-1)  
        
    return
```
#### Production C++
```cpp
std::vector<std::vector<int>> split_array(std::vector<int> array) {
    if (array.size() <= 2) {
        return { array };
    }
    
    std::vector<std::vector<int>> result;
    for (int i = 0; i < array.size() - 1; i += 2) {
        result.push_back({ array[i], array[i + 1] });
    }
    
    return result;
}

std::pair<std::vector<int>, int> sort_array(std::vector<std::vector<int>> array, int count) {
    if (array.size() <= 1) {
        return { array[0], count };
    }
    
    std::vector<std::vector<int>> new_array;
    for (int i = 0; i < array.size() - 1; i += 2) {
    
        if (array[i][0] > array[i + 1][0]) {
            std::vector<int> merge_array;
            merge_array.insert(merge_array.end(), 
			                   array[i + 1].begin(), 
				               array[i + 1].end());
            merge_array.insert(merge_array.end(), array[i].begin(), 
							   array[i].end());
            new_array.push_back(merge_array);
            count++;
        }
        
        else {
            std::vector<int> merge_array;
            merge_array.insert(merge_array.end(), array[i].begin(), 
				               array[i].end());
            merge_array.insert(merge_array.end(), 
				               array[i + 1].begin(),
				               array[i + 1].end());
            new_array.push_back(merge_array);
        }
    }
    
    return sort_array(new_array, count);
}


void solve() {
    int len_array;
    std::cin >> len_array;
    std::vector<int> array;
    std::vector<int> array_sort;
    
    for (int i = 0; i < len_array; i++) {
        int digit;
        std::cin >> digit;
        array.push_back(digit);
        array_sort.push_back(digit);
    }
    
    std::sort(array_sort.begin(), array_sort.end());
    if (array == array_sort) {
        std::cout << 0 << std::endl;
        return;
    }

    std::vector<std::vector<int>> new_array;
    new_array = split_array(array);

    int count = 0;
    for (int i = 0; i < new_array.size(); i++) {
        if (new_array[i][0] > new_array[i][1]) {
            new_array[i] = { new_array[i][1], new_array[i][0] };
            count++;
        }
    }
    
    std::vector<int> result, sort_result;
    std::pair<std::vector<int>, int> 
		    final_array_and_count = sort_array(new_array, count);
    result = final_array_and_count.first;
    sort_result = final_array_and_count.first;
    count = final_array_and_count.second;

    std::sort(sort_result.begin(), sort_result.end());

    if (result == sort_result) {
        std::cout << count << std::endl;
    }
    
    else {
        std::cout << -1 << std::endl;
    }
    return;
}
```
#### Olympic C++
```cpp
typedef vector<int> vi;
typedef vector<vector<int>> vvi;

vvi split_p(vi p) {
    if (p.size() <= 2) {
        return { p };
    }
    
    vvi res;
    for (int i = 0; i < p.size() - 1; i += 2) {
        res.push_back({ p[i], p[i + 1] });
    }
    return res;
}

pair<vector<int>, int> sort_p(vvi p, int cnt) {
    if (p.size() <= 1) {
        return { p[0], cnt };
    }
    
    vvi new_p;
    for (int i = 0; i < p.size() - 1; i += 2) {
    
        if (p[i][0] > p[i + 1][0]) {
            vi curr;
            curr.insert(curr.end(), p[i + 1].begin(), p[i + 1].end());
            curr.insert(curr.end(), p[i].begin(), p[i].end());
            new_p.push_back(curr);
            cnt++;
        }
        
        else {
            vi curr;
            curr.insert(curr.end(), p[i].begin(), p[i].end());
            curr.insert(curr.end(), p[i + 1].begin(), p[i + 1].end());
            new_p.push_back(curr);
        }
    }
    return sort_p(new_p, cnt);
}

void solve() {
    int m;
    std::cin >> m;
    vi p;
    vi p_sort;
    
    for (int i = 0; i < m; i++) {
        int digit;
        cin >> digit;
        p.push_back(digit);
        p_sort.push_back(digit);
    }
    
    sort(p_sort.begin(), p_sort.end());
    if (p == p_sort) {
        cout << 0 << endl;
        return;
    }

    vvi new_p;
    new_p = split_p(p);

    int cnt = 0;
    for (int i = 0; i < new_p.size(); i++) {
        if (new_p[i][0] > new_p[i][1]) {
            new_p[i] = { new_p[i][1], new_p[i][0] };
            cnt++;
        }
    }
    
    vi res_p, sort_res_p;
    pair<vector<int>, int> s = sort_p(new_p, cnt);
    res_p = s.first;
    sort_res_p = s.first;
    cnt = s.second;

    sort(sort_res_p.begin(), sort_res_p.end());

    if (res_p == sort_res_p) {
        cout << cnt << endl;
    }
    
    else {
        cout << -1 << endl;
    }
    return;
}
```
